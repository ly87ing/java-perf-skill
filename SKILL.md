---
name: performance-troubleshoot
description: |
  Analyze and solve performance and resource issues with automated multi-round reviews.
  è§¦å‘å…³é”®è¯ (ä¸­æ–‡): å†…å­˜æš´æ¶¨ã€OOMã€GCé¢‘ç¹ã€å“åº”æ…¢ã€CPUé«˜ã€æ¶ˆæ¯ç§¯å‹ã€èµ„æºæ³„éœ²ã€æ€§èƒ½æ’æŸ¥
  Use when:
  - Resource issues: memory spikes, OOM, GC pressure, object creation storms, resource leaks
  - Performance issues: high CPU, slow response, lock contention, IO blocking, slow queries
  - Concurrent issues: race conditions, deadlocks, thread pool exhaustion, thread dump analysis
  - System issues: message backlog, cascade failures, connection exhaustion, heap dump analysis
  - Real-time systems: Actor/Akka, WebSocket, broadcast optimization
  - Cache issues: cache penetration, cache avalanche, hot key
  Applicable to: API services, message queues, real-time push, databases, microservices.
---

# æ€§èƒ½é—®é¢˜æ’æŸ¥ Skill (Performance Troubleshoot)

åˆ†æå’Œè§£å†³æ€§èƒ½ä¸èµ„æºé—®é¢˜ï¼ŒåŒ…å«è‡ªåŠ¨åŒ–çš„å¤šè½®å®¡æŸ¥ï¼Œç¡®ä¿æ–¹æ¡ˆå®‰å…¨ã€æ­£ç¡®ã€å¥å£®ã€‚

**é€‚ç”¨åœºæ™¯**: å†…å­˜æš´æ¶¨ã€OOMã€GC é¢‘ç¹ã€å“åº”æ…¢ã€CPU é«˜ã€æ¶ˆæ¯ç§¯å‹ã€èµ„æºæ³„éœ²ç­‰ã€‚

## Quick Start

```
1. é—®é¢˜åˆ†æ â†’ 2. æ–¹æ¡ˆè®¾è®¡ â†’ 3. å¤šè½®å®¡æŸ¥ â†’ 4. æ–‡æ¡£å®Œå–„ â†’ 5. æœ€ç»ˆäº¤ä»˜
```

## Instructions

### é˜¶æ®µä¸€ï¼šé—®é¢˜åˆ†æ

**0. æ¸è¿›å¼ä¿¡æ¯æ”¶é›†** (åˆ†è½®å¼•å¯¼)

é‡‡ç”¨å¤šè½®å¯¹è¯æ–¹å¼æ”¶é›†ä¿¡æ¯ï¼Œé¿å…ä¸€æ¬¡æ€§é—®å¤ªå¤šé—®é¢˜ï¼š

**ç¬¬ 1 è½® - æ ¸å¿ƒé—®é¢˜**
```
è¯·æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜:
â–¡ å†…å­˜é—®é¢˜ (å†…å­˜æš´æ¶¨/OOM/GCé¢‘ç¹)
â–¡ æ€§èƒ½é—®é¢˜ (å“åº”æ…¢/CPUé«˜/ååä½)
â–¡ ç¨³å®šæ€§é—®é¢˜ (è¶…æ—¶/é”™è¯¯ç‡é«˜/æœåŠ¡ä¸å¯ç”¨)
â–¡ å…¶ä»– (è¯·æè¿°)
```

**ç¬¬ 2 è½® - æ ¹æ®å›ç­”è¿½é—®**

| ç¬¬1è½®å›ç­” | è¿½é—®å†…å®¹ |
|-----------|----------|
| å†…å­˜é—®é¢˜ | æ˜¯çªç„¶æš´æ¶¨è¿˜æ˜¯æŒç»­ä¸Šæ¶¨? æ˜¯å¦æœ‰OOMæ—¥å¿—? |
| æ€§èƒ½é—®é¢˜ | æ˜¯å…¨éƒ¨æ…¢è¿˜æ˜¯ç‰¹å®šæ¥å£æ…¢? å³°å€¼QPSå¤šå°‘? |
| ç¨³å®šæ€§é—®é¢˜ | æ˜¯æŒç»­ä¸å¯ç”¨è¿˜æ˜¯å¶å‘? æœ‰æ— ä¾èµ–æœåŠ¡æ•…éšœ? |

**ç¬¬ 3 è½® - èµ„æ–™æ”¶é›†**
```
è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ (æœ‰ä»€ä¹ˆæä¾›ä»€ä¹ˆï¼Œæ²¡æœ‰å¯è·³è¿‡):
â–¡ æ—¥å¿—æ–‡ä»¶è·¯å¾„
â–¡ ç›‘æ§æˆªå›¾ (å†…å­˜/CPUæ›²çº¿)
â–¡ ä»£ç ç›®å½•
â–¡ é…ç½®æ–‡ä»¶
```

---

**1. ç—‡çŠ¶â†’è¯Šæ–­â†’å¤„æ–¹å†³ç­–æ ‘**

æ ¹æ®é—®é¢˜ç°è±¡ï¼Œè‡ªåŠ¨æ¨èä¼˜åŒ–æ¨¡å¼:

```mermaid
graph TD
    A[é—®é¢˜ç°è±¡] --> B{ç±»å‹?}
    
    B -->|å†…å­˜æš´æ¶¨| C{æ¨¡å¼?}
    C -->|çªç„¶æš´æ¶¨| C1[å¯¹è±¡åˆ›å»ºé£æš´]
    C -->|æŒç»­ä¸Šæ¶¨| C2[èµ„æºæ³„éœ²]
    C1 --> C1R["âœ… æ¨è: å¯¹è±¡æ± /ç»“æœå¤ç”¨/ç‰ˆæœ¬è¿½è¸ª/æ‰¹é‡é™æµ"]
    C2 --> C2R["âœ… æ¨è: ç”Ÿå‘½å‘¨æœŸç®¡ç†/å®šæœŸæ¸…ç†/å¼±å¼•ç”¨"]
    
    B -->|GCå‹åŠ›| D{ç±»å‹?}
    D -->|Young GCé¢‘ç¹| D1["çŸ­å‘½å¯¹è±¡è¿‡å¤š"]
    D -->|Full GCé¢‘ç¹| D2["è€å¹´ä»£æ»¡"]
    D1 --> D1R["âœ… æ¨è: å¯¹è±¡æ± /é¢„åˆ†é…/å‡å°‘ä¸´æ—¶å¯¹è±¡"]
    D2 --> D2R["âœ… æ¨è: ç¼“å­˜æ·˜æ±°/èµ„æºæ¸…ç†/å †å¤§å°è°ƒæ•´"]
    
    B -->|å“åº”æ…¢| E{åŸå› ?}
    E -->|é”ç«äº‰| E1["é”ç²’åº¦å¤§"]
    E -->|IOé˜»å¡| E2["ä¸‹æ¸¸æ…¢"]
    E1 --> E1R["âœ… æ¨è: é”åˆ†æ®µ/è¯»å†™é”/æ— é”è®¾è®¡"]
    E2 --> E2R["âœ… æ¨è: å¼‚æ­¥åŒ–/ç¼“å­˜/ç†”æ–­å™¨"]
    
    B -->|æ¶ˆæ¯ç§¯å‹| F{åŸå› ?}
    F -->|æ¶ˆè´¹æ…¢| F1["å¤„ç†èƒ½åŠ›ä¸è¶³"]
    F -->|ç”Ÿäº§å¿«| F2["çªå‘æµé‡"]
    F1 --> F1R["âœ… æ¨è: æ‰¹é‡æ¶ˆè´¹/å¹¶è¡Œæ¶ˆè´¹/æ¶ˆè´¹è€…æ‰©å®¹"]
    F2 --> F2R["âœ… æ¨è: èƒŒå‹/é™æµ/é˜Ÿåˆ—æº¢å‡ºç­–ç•¥"]
```

**2. å¿«é€Ÿè¯Šæ–­è¡¨**

| ç—‡çŠ¶ | å¯èƒ½åŸå›  | æ¨èæ¨¡å¼ | æ£€æŸ¥è¦ç‚¹ |
|------|----------|----------|----------|
| å†…å­˜çªç„¶æš´æ¶¨ | çŸ­æ—¶é—´å¤§é‡å¯¹è±¡åˆ›å»º | å¯¹è±¡æ± ã€æ‰¹é‡é™æµã€ç»“æœå¤ç”¨ | CHECKLIST 5.5 |
| å†…å­˜æŒç»­ä¸Šæ¶¨ | èµ„æºæ³„éœ² | ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€å®šæœŸæ¸…ç† | CHECKLIST 7.4 |
| GC é¢‘ç¹ | ä¸´æ—¶å¯¹è±¡å¤š | å¯¹è±¡æ± ã€é¢„åˆ†é… | CHECKLIST 5.6 |
| å“åº”æ…¢(é”) | é”ç²’åº¦å¤§ | é”åˆ†æ®µã€è¯»å†™é” | CHECKLIST 2 |
| å“åº”æ…¢(IO) | ä¸‹æ¸¸é˜»å¡ | å¼‚æ­¥åŒ–ã€ç†”æ–­ã€ç¼“å­˜ | CHECKLIST 3 |
| CPU é«˜ | é‡å¤è®¡ç®— | ç¼“å­˜ã€ç‰ˆæœ¬è¿½è¸ª | CHECKLIST 2.1 |
| æ¶ˆæ¯ç§¯å‹ | æ¶ˆè´¹é€Ÿåº¦ä¸è¶³ | æ‰¹é‡æ¶ˆè´¹ã€èƒŒå‹ | CHECKLIST 4 |
| è¿æ¥è€—å°½ | è¿æ¥æ³„éœ² | è¿æ¥æ± ç®¡ç†ã€è¶…æ—¶ | CHECKLIST 3.4 |

---

**3. æ”¶é›†é—®é¢˜æ•°æ®**
   - å³°å€¼ QPS/TPS
   - å“åº”æ—¶é—´åˆ†å¸ƒ (P50/P99)
   - èµ„æºä½¿ç”¨ç‡ (CPU/å†…å­˜/è¿æ¥æ•°/é˜Ÿåˆ—æ·±åº¦)
   - é”™è¯¯ç‡ã€è¶…æ—¶ç‡ã€æ‹’ç»ç‡

**4. è¯†åˆ«ç“¶é¢ˆç±»å‹**

   | ç±»å‹ | è¡¨ç° | å¸¸è§åŸå›  |
   |------|------|----------|
   | **CPU ç“¶é¢ˆ** | CPU é«˜ï¼Œå“åº”æ…¢ | è®¡ç®—å¯†é›†ã€é”ç«äº‰ã€GC |
   | **å†…å­˜ç“¶é¢ˆ** | GC é¢‘ç¹ï¼ŒOOM | å¯¹è±¡åˆ›å»ºè¿‡å¤šã€æ³„éœ² |
   | **IO ç“¶é¢ˆ** | çº¿ç¨‹é˜»å¡ï¼Œè¶…æ—¶å¤š | æ•°æ®åº“æ…¢ã€ç½‘ç»œå»¶è¿Ÿ |
   | **å¹¶å‘ç“¶é¢ˆ** | ååå—é™ | é”ç²’åº¦å¤§ã€ä¸²è¡ŒåŒ– |
   | **ç½‘ç»œç“¶é¢ˆ** | é”™è¯¯ç‡é«˜ï¼Œè¶…æ—¶ | å¸¦å®½ä¸è¶³ã€è¿æ¥æ•°é™åˆ¶ |
   | **é˜Ÿåˆ—ç“¶é¢ˆ** | æ¶ˆæ¯ç§¯å‹ | æ¶ˆè´¹é€Ÿåº¦ < ç”Ÿäº§é€Ÿåº¦ |

**5. æ ¹å› åˆ†æ**
   - ç»˜åˆ¶è¯·æ±‚é“¾è·¯å›¾ (Mermaid)
   - æ ‡æ³¨çƒ­ç‚¹å’Œæ”¾å¤§æ•ˆåº”
   - è¯†åˆ«çº§è”å¤±è´¥é£é™©
   - é‡åŒ–é—®é¢˜å½±å“



### é˜¶æ®µäºŒï¼šæ–¹æ¡ˆè®¾è®¡

**é€šç”¨ä¼˜åŒ–æ¨¡å¼** (æ ¹æ®é—®é¢˜é€‰æ‹©é€‚ç”¨çš„):

#### 2.1 æ€§èƒ½ä¼˜åŒ–æ¨¡å¼

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | æ•ˆæœ |
|------|----------|------|
| **è¯·æ±‚åˆå¹¶ (Debouncing)** | é«˜é¢‘é‡å¤è¯·æ±‚ | å‡å°‘ 90%+ è°ƒç”¨ |
| **ç»“æœç¼“å­˜ (Caching)** | é‡å¤è®¡ç®—/æŸ¥è¯¢ | å‡å°‘ 80%+ è®¡ç®— |
| **ç»“æœå¤ç”¨ (Sharing)** | å¤šç”¨æˆ·ç›¸åŒç»“æœ | å‡å°‘ 95%+ é‡å¤ |
| **æ‰¹é‡å¤„ç† (Batching)** | å°è¯·æ±‚ç´¯ç§¯ | å‡å°‘ IO æ¬¡æ•° |
| **è¿æ¥æ±  (Pooling)** | è¿æ¥åˆ›å»ºå¼€é”€ | å‡å°‘è¿æ¥æ—¶é—´ |
| **ç‰ˆæœ¬è¿½è¸ª (Versioning)** | å˜åŒ–æ£€æµ‹ | O(1) åˆ¤æ–­ |

#### 2.2 é”ç«äº‰ä¼˜åŒ–æ¨¡å¼

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | æ•ˆæœ |
|------|----------|------|
| **é”åˆ†æ®µ (Lock Striping)** | çƒ­ç‚¹æ•°æ®ç«äº‰ | é™ä½é”ç²’åº¦ |
| **è¯»å†™åˆ†ç¦» (RWLock)** | è¯»å¤šå†™å°‘ | æé«˜è¯»å¹¶å‘ |
| **æ— é”è®¾è®¡ (Lock-free)** | æé«˜å¹¶å‘ | CAS/åŸå­ç±» |
| **ä¹è§‚é” (Optimistic)** | å†²çªå°‘ | å‡å°‘é”æŒæœ‰æ—¶é—´ |
| **å¼‚æ­¥åŒ– (Async)** | IO å¯†é›† | é‡Šæ”¾çº¿ç¨‹ |

#### 2.3 æ•…éšœå¤„ç†æ¨¡å¼

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | æ•ˆæœ |
|------|----------|------|
| **è¶…æ—¶æ§åˆ¶ (Timeout)** | IO æ“ä½œ | é˜²æ­¢æ— é™ç­‰å¾… |
| **é‡è¯•æœºåˆ¶ (Retry)** | æš‚æ—¶æ€§æ•…éšœ | æŒ‡æ•°é€€é¿ |
| **ç†”æ–­å™¨ (Circuit Breaker)** | ä¾èµ–æ•…éšœ | å¿«é€Ÿå¤±è´¥ |
| **èˆ±å£éš”ç¦» (Bulkhead)** | èµ„æºéš”ç¦» | æ•…éšœä¸æ‰©æ•£ |
| **é™çº§ç­–ç•¥ (Fallback)** | æœåŠ¡ä¸å¯ç”¨ | å¤‡é€‰æ–¹æ¡ˆ |

#### 2.4 æµé‡æ§åˆ¶æ¨¡å¼

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | æ•ˆæœ |
|------|----------|------|
| **é™æµ (Rate Limiting)** | çªå‘æµé‡ | ä»¤ç‰Œæ¡¶/æ¼æ¡¶ |
| **èƒŒå‹ (Backpressure)** | æ¶ˆæ¯ç§¯å‹ | åå‘å‹åŠ›ä¼ é€’ |
| **è´Ÿè½½å‡è¡¡ (Load Balancing)** | è¯·æ±‚åˆ†å‘ | å‡åŒ€åˆ†å¸ƒ |
| **ä¼˜é›…é™çº§ (Graceful Degradation)** | è¿‡è½½ä¿æŠ¤ | ä¸¢å¼ƒä½ä¼˜å…ˆçº§ |
| **é˜Ÿåˆ—æº¢å‡ºå¤„ç† (Queue Overflow)** | é˜Ÿåˆ—æ»¡ | æ‹’ç»/ä¸¢å¼ƒç­–ç•¥ |

#### 2.5 Actor å¹¶å‘æ¨¡å¼ (Akka/Erlang/Virtual Threads)

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | æ•ˆæœ |
|------|----------|------|
| **æ¶ˆæ¯ä¼ é€’ (Message Passing)** | çŠ¶æ€éš”ç¦» | æ— é”å¹¶å‘ |
| **Actor åˆ†ç‰‡ (Sharding)** | å¤§é‡å®ä½“ | åˆ†å¸ƒå¼æ‰©å±• |
| **Mailbox ç®¡ç†** | æ¶ˆæ¯å †ç§¯ | æœ‰ç•Œ/ä¼˜å…ˆçº§é˜Ÿåˆ— |
| **ç›‘ç£ç­–ç•¥ (Supervision)** | æ•…éšœæ¢å¤ | é‡å¯/åœæ­¢/å‡çº§ |
| **èƒŒå‹ä¿¡å· (Backpressure)** | é€Ÿç‡ä¸åŒ¹é… | åå‘å‹åŠ› |

#### 2.6 é•¿è¿æ¥ç®¡ç†æ¨¡å¼ (WebSocket/SSE/gRPC Stream)

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | æ•ˆæœ |
|------|----------|------|
| **å¿ƒè·³æ£€æµ‹ (Heartbeat)** | è¿æ¥ä¿æ´» | åŠæ—¶å‘ç°æ–­è¿ |
| **é‡è¿æœºåˆ¶ (Reconnection)** | ç½‘ç»œæŠ–åŠ¨ | æŒ‡æ•°é€€é¿é‡è¿ |
| **è¿æ¥æ± ç®¡ç† (Connection Pool)** | èµ„æºå¤ç”¨ | å‡å°‘æ¡æ‰‹å¼€é”€ |
| **å¹¿æ’­ä¼˜åŒ– (Broadcast)** | å¤šç”¨æˆ·æ¨é€ | å‡å°‘é‡å¤åºåˆ—åŒ– |
| **ä¼šè¯ç®¡ç† (Session)** | ç”¨æˆ·çŠ¶æ€ | ç”Ÿå‘½å‘¨æœŸæ¸…ç† |

#### 2.7 èµ„æºçªå¢é˜²æŠ¤æ¨¡å¼ (çŸ­æ—¶é—´å¤§æ‰¹é‡åˆ›å»º)

| æ¨¡å¼ | é€‚ç”¨åœºæ™¯ | æ•ˆæœ |
|------|----------|------|
| **å¯¹è±¡æ±  (Object Pool)** | é¢‘ç¹åˆ›å»ºé”€æ¯ | å¤ç”¨å¯¹è±¡ï¼Œå‡å°‘ GC |
| **æ‰¹é‡åˆ›å»ºé™æµ** | çªå‘å¤§é‡è¯·æ±‚ | é™åˆ¶åˆ›å»ºé€Ÿç‡ |
| **å»¶è¿Ÿåˆå§‹åŒ– (Lazy Init)** | éå¿…éœ€å¯¹è±¡ | æŒ‰éœ€åˆ›å»º |
| **é¢„åˆ†é… (Pre-allocation)** | å·²çŸ¥å®¹é‡ | é¿å…æ‰©å®¹å¼€é”€ |
| **å¼±å¼•ç”¨ç¼“å­˜ (WeakReference)** | å¤§å¯¹è±¡ç¼“å­˜ | GC å¯å›æ”¶ |
| **é›¶æ‹·è´ (Zero-copy)** | å¤§æ•°æ®ä¼ è¾“ | å‡å°‘å¤åˆ¶ |
| **ä¸å¯å˜å¯¹è±¡ (Immutable)** | å…±äº«æ•°æ® | å®‰å…¨å¤ç”¨ |

---

### è¯Šæ–­å·¥å…·æ¨è

æ ¹æ®é—®é¢˜ç±»å‹ï¼Œæ¨èä½¿ç”¨ä»¥ä¸‹å·¥å…·:

| é—®é¢˜ç±»å‹ | æ¨èå·¥å…· | ç”¨é€” |
|----------|----------|------|
| **å†…å­˜é—®é¢˜** | jmap, MAT, VisualVM | heap dump åˆ†æ |
| **CPU é—®é¢˜** | async-profiler, arthas | ç«ç„°å›¾ã€çƒ­ç‚¹æ–¹æ³• |
| **çº¿ç¨‹é—®é¢˜** | jstack, arthas | thread dump åˆ†æ |
| **GC é—®é¢˜** | GCViewer, GCEasy | GC æ—¥å¿—åˆ†æ |
| **åœ¨çº¿è¯Šæ–­** | arthas | åŠ¨æ€è¿½è¸ªã€çƒ­ä¿®å¤ |

**å¸¸ç”¨è¯Šæ–­å‘½ä»¤**:

```bash
# 1. Heap Dump
jmap -dump:format=b,file=heap.hprof <pid>

# 2. Thread Dump
jstack <pid> > thread.dump

# 3. GC æ—¥å¿—
java -Xlog:gc*:file=gc.log:time,uptime:filecount=5,filesize=10M

# 4. ç«ç„°å›¾ (async-profiler)
./profiler.sh -d 30 -f flamegraph.html <pid>

# 5. Arthas åœ¨çº¿è¯Šæ–­
java -jar arthas-boot.jar
> dashboard          # å®æ—¶ç›‘æ§
> thread -n 3        # æœ€å¿™çš„3ä¸ªçº¿ç¨‹
> heapdump /tmp/dump.hprof  # ç”Ÿæˆå †è½¬å‚¨
> watch com.xxx.Service method '{params, returnObj}'  # è§‚å¯Ÿæ–¹æ³•è°ƒç”¨
```

---

### åæ¨¡å¼è­¦ç¤º (âŒ ä¸è¦è¿™æ ·åš)

#### âŒ åæ¨¡å¼ 1: é”å†…æ‰§è¡Œ IO æ“ä½œ

```java
// âŒ é”™è¯¯: é”å†…æ‰§è¡Œç½‘ç»œè°ƒç”¨
synchronized (lock) {
    String result = httpClient.get(url);  // ğŸ”´ é˜»å¡å…¶ä»–çº¿ç¨‹!
    cache.put(key, result);
}

// âœ… æ­£ç¡®: å…ˆè·å–æ•°æ®ï¼Œå†åŠ é”
String result = httpClient.get(url);  // é”å¤–æ‰§è¡Œ
synchronized (lock) {
    cache.put(key, result);  // åªä¿æŠ¤å†™æ“ä½œ
}
```

#### âŒ åæ¨¡å¼ 2: å¾ªç¯å†…åˆ›å»ºå¯¹è±¡

```java
// âŒ é”™è¯¯: æ¯æ¬¡å¾ªç¯éƒ½åˆ›å»ºå¯¹è±¡
for (int i = 0; i < 10000; i++) {
    StringBuilder sb = new StringBuilder();  // ğŸ”´ åˆ›å»º1ä¸‡ä¸ªå¯¹è±¡!
    sb.append(data[i]);
    process(sb.toString());
}

// âœ… æ­£ç¡®: å¤ç”¨å¯¹è±¡
StringBuilder sb = new StringBuilder();
for (int i = 0; i < 10000; i++) {
    sb.setLength(0);  // é‡ç½®è€Œéæ–°å»º
    sb.append(data[i]);
    process(sb.toString());
}
```

#### âŒ åæ¨¡å¼ 3: æ— ç•Œé˜Ÿåˆ—

```java
// âŒ é”™è¯¯: æ— ç•Œé˜Ÿåˆ—ï¼Œå¯èƒ½ OOM
ExecutorService executor = Executors.newFixedThreadPool(10);
// å†…éƒ¨ä½¿ç”¨ LinkedBlockingQueue æ— ç•Œé˜Ÿåˆ—!

// âœ… æ­£ç¡®: æœ‰ç•Œé˜Ÿåˆ— + æ‹’ç»ç­–ç•¥
ExecutorService executor = new ThreadPoolExecutor(
    10, 10, 0L, TimeUnit.MILLISECONDS,
    new ArrayBlockingQueue<>(1000),  // æœ‰ç•Œé˜Ÿåˆ—
    new ThreadPoolExecutor.CallerRunsPolicy()  // èƒŒå‹
);
```

#### âŒ åæ¨¡å¼ 4: åŒé‡æ£€æŸ¥é”é”™è¯¯å®ç°

```java
// âŒ é”™è¯¯: æ²¡æœ‰ volatile
private static Instance instance;
if (instance == null) {
    synchronized (lock) {
        if (instance == null) {
            instance = new Instance();  // ğŸ”´ å¯èƒ½çœ‹åˆ°æœªåˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡!
        }
    }
}

// âœ… æ­£ç¡®: ä½¿ç”¨ volatile
private static volatile Instance instance;  // æ·»åŠ  volatile
```

#### âŒ åæ¨¡å¼ 5: subList è¿”å›è§†å›¾

```java
// âŒ é”™è¯¯: subList è¿”å›çš„æ˜¯è§†å›¾ï¼Œä¸æ˜¯å‰¯æœ¬
List<T> result = list.subList(0, 10);
return result;  // ğŸ”´ åŸåˆ—è¡¨å˜åŒ–ä¼šå½±å“ result!

// âœ… æ­£ç¡®: åˆ›å»ºå‰¯æœ¬
List<T> result = new ArrayList<>(list.subList(0, 10));
return result;
```

---

**å¯¹æ¯ä¸ªä¼˜åŒ–ç‚¹ï¼Œå¿…é¡»åŒ…å«**:
- é—®é¢˜æè¿° (æ•°æ®æ”¯æ’‘)
- è®¾è®¡åŸç† (Mermaid å›¾)
- å®Œæ•´ä»£ç  (å¯ç›´æ¥ä½¿ç”¨)
- é¢„æœŸæ•ˆæœ (é‡åŒ–æŒ‡æ ‡)

### é˜¶æ®µä¸‰ï¼šå¤šè½®å®¡æŸ¥

**å¿…é¡»å¯¹æ¯ä¸ªä»£ç å—è¿›è¡Œä»¥ä¸‹æ£€æŸ¥ï¼Œå‘ç°é—®é¢˜ç«‹å³ä¿®å¤**:

#### 3.1 å¹¶å‘å®‰å…¨
```
â–¡ åŸå­æ€§: synchronized/é”ä¿æŠ¤å®Œæ•´æ“ä½œ
â–¡ å¯è§æ€§: volatile/åŸå­ç±»ä½¿ç”¨æ­£ç¡®
â–¡ ç«æ€æ¡ä»¶: æ£€æŸ¥-æ‰§è¡Œæ¨¡å¼æ˜¯å¦åŸå­
â–¡ æ­»é”: é”é¡ºåºæ˜¯å¦ä¸€è‡´ã€æœ‰æ— è¶…æ—¶
```

#### 3.2 é”ç«äº‰
```
â–¡ é”ç²’åº¦: æ˜¯å¦è¿‡å¤§å¯¼è‡´ä¸²è¡ŒåŒ–
â–¡ é”æŒæœ‰æ—¶é—´: é”å†…æ˜¯å¦æœ‰ IO/è€—æ—¶æ“ä½œ
â–¡ çƒ­ç‚¹é”: æ˜¯å¦éœ€è¦é”åˆ†æ®µ
â–¡ è¯»å†™æ¯”: æ˜¯å¦åº”è¯¥ç”¨è¯»å†™é”
```

#### 3.3 IO/ç½‘ç»œå¼‚å¸¸
```
â–¡ è¶…æ—¶è®¾ç½®: æ‰€æœ‰ IO æ“ä½œæ˜¯å¦æœ‰è¶…æ—¶
â–¡ é‡è¯•æœºåˆ¶: æ˜¯å¦æœ‰æŒ‡æ•°é€€é¿
â–¡ ç†”æ–­ä¿æŠ¤: æ˜¯å¦æœ‰ç†”æ–­å™¨
â–¡ è¿æ¥ç®¡ç†: è¿æ¥æ± é…ç½®æ˜¯å¦åˆç†
â–¡ èµ„æºé‡Šæ”¾: finally/defer æ˜¯å¦å…³é—­èµ„æº
```

#### 3.4 æ¶ˆæ¯ç§¯å‹
```
â–¡ èƒŒå‹æœºåˆ¶: æ˜¯å¦æœ‰åå‘å‹åŠ›
â–¡ é˜Ÿåˆ—å®¹é‡: æ˜¯å¦æœ‰ä¸Šé™
â–¡ æº¢å‡ºç­–ç•¥: æ»¡æ—¶å¦‚ä½•å¤„ç†
â–¡ æ¶ˆè´¹é€Ÿåº¦: æ˜¯å¦å¯æ‰©å®¹æ¶ˆè´¹è€…
â–¡ ä¼˜å…ˆçº§: æ˜¯å¦æ”¯æŒä¼˜å…ˆçº§å¤„ç†
```

#### 3.5 èµ„æºè€—å°½
```
â–¡ çº¿ç¨‹æ± æ»¡: æ‹’ç»ç­–ç•¥æ˜¯å¦åˆç†
â–¡ è¿æ¥æ± æ»¡: ç­‰å¾…è¶…æ—¶æ˜¯å¦è®¾ç½®
â–¡ å†…å­˜ä¸è¶³: æ˜¯å¦æœ‰é™åˆ¶/é™çº§
â–¡ ç£ç›˜ç©ºé—´: æ—¥å¿—/ç¼“å­˜æ˜¯å¦æœ‰æ¸…ç†
```

#### 3.6 çº§è”å¤±è´¥
```
â–¡ ä¾èµ–éš”ç¦»: æ˜¯å¦ä½¿ç”¨èˆ±å£æ¨¡å¼
â–¡ å¤±è´¥ä¼ æ’­: æ˜¯å¦ä¼šå¼•èµ·é›ªå´©
â–¡ è¶…æ—¶ä¼ é€’: æ˜¯å¦è®¾ç½®å…¨é“¾è·¯è¶…æ—¶
â–¡ å¥åº·æ£€æŸ¥: æ˜¯å¦æœ‰ä¾èµ–æ¢æ´»
```

#### 3.7 èµ„æºç®¡ç†
```
â–¡ çº¿ç¨‹æ± : æœ‰å…³é—­æ–¹æ³•ã€å¤§å°åˆç†
â–¡ è¿æ¥æ± : æœ‰å½’è¿˜/å…³é—­é€»è¾‘
â–¡ ç¼“å­˜: æœ‰å¤±æ•ˆ/æ·˜æ±°æœºåˆ¶
â–¡ ä¸´æ—¶å¯¹è±¡: æ— æ³„éœ²é£é™©
```

#### 3.8 é…ç½®ä¸è¾¹ç•Œ
```
â–¡ å‚æ•°æ ¡éªŒ: æ— æ•ˆå€¼æœ‰å¤„ç†
â–¡ ç©ºå€¼å¤„ç†: null/ç©ºé›†åˆå®‰å…¨
â–¡ è¾¹ç•Œæ¡ä»¶: é¦–æ¬¡/æå€¼æ­£ç¡®
```

### é˜¶æ®µå››ï¼šæ–‡æ¡£å®Œå–„

æœ€ç»ˆæ–‡æ¡£å¿…é¡»åŒ…å« (ä½¿ç”¨ [TEMPLATE.md](TEMPLATE.md)):

1. **é—®é¢˜èƒŒæ™¯** - æ•°æ®è¡¨æ ¼ + é“¾è·¯å›¾
2. **æ ¸å¿ƒæ¶æ„** - ä¼˜åŒ–åæµç¨‹å›¾
3. **ä¼˜åŒ–ç‚¹è¯¦è§£** - æ¯ä¸ªä¼˜åŒ–çš„å®Œæ•´ä»£ç 
4. **é…ç½®ä¸­å¿ƒ** - é…ç½®é¡¹ + é»˜è®¤å€¼ + è¯´æ˜
5. **ç›‘æ§ä½“ç³»** - æŒ‡æ ‡å®šä¹‰ + å‘Šè­¦è§„åˆ™
6. **æ—¥å¿—è®¾è®¡** - åˆ†çº§ + é‡‡æ · + æ ¼å¼
7. **å®æ–½æŒ‡å—** - å‰ç½®æ¡ä»¶ + é¡ºåº + éªŒè¯
8. **ç”Ÿå‘½å‘¨æœŸç®¡ç†** - èµ„æºæ¸…ç†
9. **æ•…éšœå¤„ç†** - ç†”æ–­ã€é™çº§ã€é‡è¯•ç­–ç•¥
10. **å‹æµ‹æ–¹æ¡ˆ** - åœºæ™¯ + æŒ‡æ ‡

**è¾“å‡ºæ ¼å¼å¼ºåˆ¶è§„èŒƒ**:

æ¯ä¸ªä¼˜åŒ–ç‚¹å¿…é¡»åŒ…å«ä»¥ä¸‹å†…å®¹ï¼Œç¼ºä¸€ä¸å¯:

| å¿…é¡»é¡¹ | æ ¼å¼è¦æ±‚ | ç¤ºä¾‹ |
|--------|----------|------|
| **é—®é¢˜æè¿°** | æ•°æ®è¡¨æ ¼ | "å³°å€¼ 2000 QPSï¼Œå†…å­˜ä» 3GB æ¶¨åˆ° 16GB" |
| **é—®é¢˜åˆ†æå›¾** | Mermaid æµç¨‹å›¾ | å±•ç¤ºé—®é¢˜å‘ç”Ÿçš„é“¾è·¯å’Œæ”¾å¤§æ•ˆåº” |
| **è§£å†³æ–¹æ¡ˆ** | æ¨èæ¨¡å¼è¡¨æ ¼ | å¯¹è±¡æ± ã€ç»“æœå¤ç”¨ã€ç‰ˆæœ¬è¿½è¸ª |
| **æ–¹æ¡ˆè®¾è®¡å›¾** | Mermaid æ¶æ„å›¾ | å±•ç¤ºä¼˜åŒ–åçš„æ•°æ®æµ |
| **å®Œæ•´ä»£ç ** | å¯ç›´æ¥å¤åˆ¶ä½¿ç”¨ | å«æ³¨é‡Šã€å¼‚å¸¸å¤„ç†ã€ç”Ÿå‘½å‘¨æœŸ |
| **é¢„æœŸæ•ˆæœ** | é‡åŒ–æŒ‡æ ‡ | "å†…å­˜å³°å€¼é™ä½ 80%ï¼ŒGC å‡å°‘ 90%" |
| **éªŒè¯æ–¹æ³•** | æµ‹è¯•/ç›‘æ§æ–¹å¼ | å‹æµ‹è„šæœ¬ + ç›‘æ§æŒ‡æ ‡ |

### é˜¶æ®µäº”ï¼šæœ€ç»ˆäº¤ä»˜

```
â–¡ å¹¶å‘å®‰å…¨å·²å®¡æŸ¥
â–¡ é”ç«äº‰å·²ä¼˜åŒ–
â–¡ IO/ç½‘ç»œå¼‚å¸¸å·²å¤„ç†
â–¡ æ¶ˆæ¯ç§¯å‹å·²é˜²æŠ¤
â–¡ èµ„æºè€—å°½å·²å¤„ç†
â–¡ çº§è”å¤±è´¥å·²éš”ç¦»
â–¡ èµ„æºç®¡ç†å·²å®Œå–„
â–¡ æ—¥å¿—ç›‘æ§å®Œæ•´
â–¡ æ–‡æ¡£ç»“æ„å®Œæ•´
â–¡ æ¯ä¸ªä¼˜åŒ–æœ‰å®Œæ•´å›¾+ä»£ç +æ•ˆæœ
```

## Examples

### Example 1: å†…å­˜æš´æ¶¨ä¼˜åŒ– (å®Œæ•´ç¤ºä¾‹)

#### 1.1 é—®é¢˜æè¿°

| æŒ‡æ ‡ | æ­£å¸¸å€¼ | å¼‚å¸¸å€¼ | å½±å“ |
|------|--------|--------|------|
| å†…å­˜ | 3.7 GB | 16.1 GB | OOM é£é™© |
| GC é¢‘ç‡ | 10æ¬¡/åˆ†é’Ÿ | 100æ¬¡/åˆ†é’Ÿ | åº”ç”¨å¡é¡¿ |
| æ— æ•ˆè®¡ç®— | 0 | 178,755 æ¬¡ | CPU æµªè´¹ |

#### 1.2 é—®é¢˜åˆ†æå›¾

```mermaid
graph TD
    A[1æ¬¡ç”¨æˆ·æ“ä½œ] --> B[è§¦å‘çŠ¶æ€å˜åŒ–]
    B --> C[è°ƒç”¨ sendMemberList]
    C --> D{æ£€æŸ¥æ˜¯å¦å˜åŒ–?}
    D -->|æ¯æ¬¡éƒ½è®¡ç®—| E[åˆ›å»ºä¸´æ—¶å¯¹è±¡]
    E --> F[è®¡ç®— MD5]
    F --> G{MD5 å˜åŒ–?}
    G -->|90%æœªå˜åŒ–| H[ä¸¢å¼ƒç»“æœ]
    G -->|10%å˜åŒ–| I[å‘é€æ¶ˆæ¯]
    
    H --> J[âŒ æµªè´¹çš„è®¡ç®—]
    
    style J fill:#ff4444,color:#fff
    
    K[é—®é¢˜: åŒä¸€è¯·æ±‚è¢«æ”¾å¤§ 6559 æ¬¡]
    K --> L[å¯¼è‡´: çŸ­æ—¶é—´åˆ›å»ºå¤§é‡ä¸´æ—¶å¯¹è±¡]
    L --> M[ç»“æœ: å†…å­˜æš´æ¶¨ 3GB â†’ 16GB]
```

#### 1.3 è§£å†³æ–¹æ¡ˆ

| ä¼˜åŒ–æ¨¡å¼ | ä½œç”¨ | é¢„æœŸæ•ˆæœ |
|----------|------|----------|
| **ç‰ˆæœ¬è¿½è¸ª** | O(1) åˆ¤æ–­æ˜¯å¦å˜åŒ– | å‡å°‘ 90% æ— æ•ˆè®¡ç®— |
| **è¯·æ±‚åˆå¹¶** | åˆå¹¶é«˜é¢‘è¯·æ±‚ | å‡å°‘ 95% è°ƒç”¨æ¬¡æ•° |
| **ç»“æœå¤ç”¨** | å…±äº«é»˜è®¤è§†å›¾ | å‡å°‘ 95% å¯¹è±¡åˆ›å»º |

#### 1.4 æ–¹æ¡ˆè®¾è®¡å›¾

```mermaid
graph TD
    A[ç”¨æˆ·æ“ä½œ] --> B[markChanged - version++]
    B --> C[requestSendMemberList]
    C --> D[é˜²æŠ–å™¨]
    D --> E{å»¶è¿Ÿå†…æœ‰æ–°è¯·æ±‚?}
    E -->|æ˜¯| D
    E -->|å¦| F{needsPush?}
    F -->|versionæœªå˜| G[è·³è¿‡ âœ“]
    F -->|versionå˜åŒ–| H[è·å–ç¼“å­˜è§†å›¾]
    H --> I[å‘é€æ¶ˆæ¯]
    
    style G fill:#90EE90
    style I fill:#90EE90
```

#### 1.5 æ ¸å¿ƒä»£ç 

```java
/**
 * ç‰ˆæœ¬å·ç®¡ç†å™¨ - æ›¿ä»£è„æ ‡è®°å’ŒMD5æ¯”è¾ƒ
 */
public class VersionManager {
    private final AtomicLong currentVersion = new AtomicLong(0);
    private volatile long lastPushedVersion = -1;
    
    /** æ ‡è®°å˜åŒ– - O(1) */
    public void markChanged() {
        currentVersion.incrementAndGet();
    }
    
    /** åˆ¤æ–­æ˜¯å¦éœ€è¦æ¨é€ - O(1) */
    public boolean needsPush() {
        return currentVersion.get() > lastPushedVersion;
    }
    
    /** æ ‡è®°å·²æ¨é€ */
    public void markPushed() {
        lastPushedVersion = currentVersion.get();
    }
}
```

```java
/**
 * è‡ªé€‚åº”é˜²æŠ–å™¨ - åˆå¹¶é«˜é¢‘è¯·æ±‚
 */
@Component
public class AdaptiveDebouncer {
    private final ConcurrentHashMap<String, DebouncedTask> tasks = new ConcurrentHashMap<>();
    
    public void request(String key, Runnable action) {
        tasks.compute(key, (k, existing) -> {
            if (existing != null) {
                existing.cancel();  // å–æ¶ˆæ—§ä»»åŠ¡
            }
            return scheduleNew(key, action);  // è°ƒåº¦æ–°ä»»åŠ¡
        });
    }
}
```

#### 1.6 é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹å–„ |
|------|--------|--------|------|
| å†…å­˜å³°å€¼ | 16.1 GB | < 4 GB | **75%â†“** |
| GC é¢‘ç‡ | 100æ¬¡/åˆ†é’Ÿ | 10æ¬¡/åˆ†é’Ÿ | **90%â†“** |
| æ¨é€æ¬¡æ•° | 178,755 | < 10,000 | **95%â†“** |

#### 1.7 éªŒè¯æ–¹æ³•

```bash
# å‹æµ‹å‘½ä»¤
wrk -t10 -c100 -d60s http://localhost:8080/api/meeting/join

# ç›‘æ§æŒ‡æ ‡
curl http://localhost:8080/actuator/metrics/jvm.memory.used
curl http://localhost:8080/actuator/metrics/jvm.gc.pause
```

---

### Example 2: æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹ä¼˜åŒ–
**æ–¹æ¡ˆ**: å¼‚æ­¥åŒ– + ç†”æ–­å™¨ + è¿æ¥æ± ä¼˜åŒ– + è¶…æ—¶æ§åˆ¶
**æ•ˆæœ**: P99 é™è‡³ 50msï¼Œæ•…éšœéš”ç¦»

### Example 2: æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹ä¼˜åŒ–

**é—®é¢˜**: æ¶ˆæ¯ç§¯å‹ 100 ä¸‡+ï¼Œæ¶ˆè´¹é€Ÿåº¦è·Ÿä¸ä¸Š
**æ–¹æ¡ˆ**: æ‰¹é‡æ¶ˆè´¹ + èƒŒå‹ + æ¶ˆè´¹è€…æ‰©å®¹ + ä¼˜å…ˆçº§é˜Ÿåˆ—
**æ•ˆæœ**: ç§¯å‹æ¸…é›¶ï¼Œå»¶è¿Ÿ < 1s

### Example 3: å…¸å‹é—®é¢˜ä¿®å¤

**é”ç«äº‰ä¼˜åŒ–**:
```java
// é—®é¢˜: å…¨å±€é”ï¼Œæ‰€æœ‰è¯·æ±‚ä¸²è¡Œ
private final Object lock = new Object();
synchronized (lock) { ... }

// ä¿®å¤: é”åˆ†æ®µ
private final ConcurrentHashMap<String, Object> lockMap = new ConcurrentHashMap<>();
Object segmentLock = lockMap.computeIfAbsent(key.hashCode() % 16, k -> new Object());
synchronized (segmentLock) { ... }
```

**ç†”æ–­å™¨æ¨¡å¼**:
```java
// ä½¿ç”¨ Resilience4j
CircuitBreaker circuitBreaker = CircuitBreaker.ofDefaults("backend");
Supplier<String> decorated = CircuitBreaker.decorateSupplier(circuitBreaker, 
    () -> backendService.call());
Try.ofSupplier(decorated)
    .recover(throwable -> "fallback");
```

**èƒŒå‹æœºåˆ¶**:
```java
// æœ‰ç•Œé˜Ÿåˆ— + æ‹’ç»ç­–ç•¥
new ThreadPoolExecutor(
    coreSize, maxSize, keepAlive, TimeUnit.SECONDS,
    new ArrayBlockingQueue<>(1000),  // æœ‰ç•Œé˜Ÿåˆ—
    new ThreadPoolExecutor.CallerRunsPolicy()  // è°ƒç”¨è€…æ‰§è¡Œ=èƒŒå‹
);
```

**è¶…æ—¶æ§åˆ¶**:
```java
// å…¨é“¾è·¯è¶…æ—¶
CompletableFuture.supplyAsync(() -> service.call())
    .orTimeout(500, TimeUnit.MILLISECONDS)
    .exceptionally(e -> fallback());
```

## Language Support

| è¯­è¨€ | å¹¶å‘åŸè¯­ | ç†”æ–­/é™æµæ¡†æ¶ |
|------|----------|--------------|
| **Java** | synchronized, Lock, Atomic* | Resilience4j, Sentinel |
| **Go** | goroutine, channel, sync | go-resilience, uber/ratelimit |
| **Python** | asyncio, threading | pybreaker, ratelimit |
| **Node.js** | async/await, Worker | opossum, bottleneck |

## Resources

- [CHECKLIST.md](CHECKLIST.md) - å®Œæ•´å®¡æŸ¥æ£€æŸ¥æ¸…å•
- [TEMPLATE.md](TEMPLATE.md) - æ–‡æ¡£æ¨¡æ¿
